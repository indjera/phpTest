<!DOCTYPE html>
<html>
    <head>
        <title>
            Some PHP page
        </title>
		<meta http-equiv = "content-type" content = "text/html; charset = UTF-8" />
        <script type="text/javascript" src="js/jquery-2.0.1.min.js"></script>
        <script type="text/javascript" src="js/underscore-min.js"></script>
        <script type="text/javascript" src="js/VModel.js"></script>
        <script type="text/javascript" src="js/knockout-2.2.1.js"></script>
        <script type="text/javascript" src="js/knockout.mapping.js"></script>
        <script type="text/javascript" src="js/menu.js"></script>
        <link rel="stylesheet" type="text/css" href="css/general.css"/>
    </head>
    <body>
        <div class="wrapper">
            <header class="page-title">
                Bug Tracking System
            </header>
            <nav >
                <ul id="vivev" class="clearfix horizontal-menu" data-bind="foreach: getHorisontalItem">
                    <li data-bind="click: $root.getVerticalItems,text: $data"></li>
                </ul>
            </nav>
            <section class="clearfix central-content">
                <header>
                </header>
				<nav class=" left-navigation">
				  <ul data-bind="foreach: verticalMenu">
				     <li ><a href="#" data-bind=" text: $data"></a></li>
				  </ul>
				</nav>
                <article class="article-content">
                    <table class="races">
                        <thead>
                        <tr>
                          <th>Събитие</th>
                          <th>Дата</th>
                          <th>Място на провеждане</th>
                        </tr>
                        </thead>
                        <tbody data-bind="foreach:$root.races">
                          <tr data-bind="click: $root.goToResults ">
                              <td data-bind="text:$data.name"></td>
                              <td data-bind="text:$data.date"></td>
                              <td data-bind="text: $data.location"></td>
                          </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody data-bind="foreach:$root.results">
                            <tr data-bind="text:$data"></tr>
                        </tbody>
                    </table>
                    <input type="button" value="submit"  data-bind=" event: {click: function (data, ev) { getAlert(data, ev); alert(12);}}" />
                </article>
            </section>
        </div>
		<script>
		    $(document).ready(function () {
		        var vModel = new VModel(function (vm) {

		            vm.verticalMenu = ko.observableArray([]);
		            vm.results = ko.observableArray([]);
		            vm.races = ko.observableArray([]);
		            vm.isVisibleRaces = ko.observable(true);
		            vm.isVisibleResults = ko.observable(false);

		            vm.getResults = function () {
		                vm.invokeWebService("resultsBL.php", { func: "GetAll"}, function (result) {
		                    vm.results(result);
		                });
		            }

		            vm.goToResults = function (data, ev) {
		                vm.getResults();
		                vm.isVisibleRaces(false);
		                vm.isVisibleResults(true);

		            }

		            vm.getRaces = function () {
		                vm.invokeWebService("racesBL.php", {func: "GetAll"}, function (result) {
		                    vm.races(result);
		                });
		            }
		            vm.getRaces();
		            

		            vm.getHorisontalItem = ko.computed(function () {
		                var arr = $.map(menuList, function (v, k) { return k; });
		                return arr;
		            });

		            vm.getDiscipline = function () {
		                vm.invokeWebService("disciplineBL.php", {func:"GetAll",param:"1"}, function (result) {
		                    vm.verticalMenu(result);
		                });
		            }

		            vm.getVerticalItems = function (data, ev) {
		                $(".horizontal-menu li").removeClass();
		                $(ev.target).addClass("selected-item");
		                if (data) {
		                    vm.verticalMenu(menuList[data]);
		                }
		            }

		            vm.invokeWebService("disciplineBL.php", { func: "GetDisciplineByCategory", param: "A" }, function (result) {
		                vm.verticalMenu(result);
		            });

		            vm.bind();
		        });
		    });
		</script>
    </body>
</html>